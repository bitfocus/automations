generator client {
  provider = "prisma-client"
  output   = "../src/prisma"
}

datasource db {
  provider = "mysql"
}

model CompanionModules {
  id         Int               @id @default(autoincrement())
  type       StatsSamplePeriod
  module     String            @db.VarChar(64)
  user_count Int
  ts         DateTime          @default(now()) @db.DateTime(0)

  @@index([module], map: "module")
  @@index([ts], map: "ts")
  @@index([type], map: "type")
  @@map("companion_modules")
}

model CompanionPlatformStats {
  id            Int               @id @default(autoincrement())
  type          StatsSamplePeriod
  platform      String            @db.VarChar(32)
  release_group String            @db.VarChar(64)
  user_count    Int
  ts            DateTime          @default(now()) @db.DateTime(0)

  @@index([ts])
  @@index([type])
  @@map("companion_platform_stats")
}

model CompanionPlatforms {
  id         Int               @id @default(autoincrement())
  type       StatsSamplePeriod
  platform   String            @db.VarChar(32)
  arch       String            @db.VarChar(16)
  user_count Int
  ts         DateTime          @default(now()) @db.DateTime(0)

  @@index([ts])
  @@index([type])
  @@map("companion_platforms")
}

model CompanionUsers {
  id         Int               @id @default(autoincrement())
  type       StatsSamplePeriod
  version    String            @db.VarChar(64)
  user_count Int
  ts         DateTime          @default(now()) @db.DateTime(0)

  @@index([ts], map: "ts")
  @@index([type], map: "type")
  @@map("companion_users")
}

// Count number of unique user+surface pairs seen in the period
model CompanionSurfaceDailyCounts {
  id          Int               @id @default(autoincrement())
  type        StatsSamplePeriod
  description String            @db.VarChar(128)
  count       Int
  ts          DateTime          @default(now()) @db.DateTime(0)

  @@index([ts], map: "ts")
  @@index([type], map: "type")
}

// Count total number of seen surfaces
model CompanionSurfaceTotalSeen {
  id          Int      @id @default(autoincrement())
  description String   @db.VarChar(128)
  count       Int
  ts          DateTime @default(now()) @db.DateTime(0)

  @@index([ts], map: "ts")
}

enum StatsSamplePeriod {
  day1  @map("1day")
  day7  @map("7day")
  day30 @map("30day")
}
